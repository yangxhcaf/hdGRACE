library(dplyr)
library(rgdal)
library(raster)
library(magrittr)

## Multiply trend and baseline status by vulnerability filter
Vulnerability.filter <- raster("Z:/2.active_projects/Xander/! GIS_files/R_gis_exports/Vulnerability.filter.tif")
Flooding.mod <- raster("Z:/2.active_projects/Xander/! GIS_files/R_gis_exports/GRACEmod_FLOODS.tif")
WaterStress.mod <- raster("Z:/2.active_projects/Xander/! GIS_files/R_gis_exports/GRACEmod_STRESS.tif")

# For water stress
WaterStress.Vulnerability <- raster(Vulnerability.filter)
# clip WaterStress.mod to no higher than a score of 5
WaterStress.mod[WaterStress.mod > 5] <- 5
WaterStress.Vulnerability <- WaterStress.mod * Vulnerability.filter
writeRaster(WaterStress.Vulnerability, 
            filename="Z:/2.active_projects/Xander/! GIS_files/R_gis_exports/WSVI_STRESS.tif", 
            format="GTiff", overwrite=TRUE)

# For flooding
Flooding.Vulnerability <- raster(Vulnerability.filter)
# clip WaterStress.mod to no higher than a score of 5
Flooding.mod[Flooding.mod > 5] <- 5

Flooding.Vulnerability <- Flooding.mod * Vulnerability.filter
writeRaster(Flooding.Vulnerability, 
            filename="Z:/2.active_projects/Xander/! GIS_files/R_gis_exports/WSVI_FLOOD.tif", 
            format="GTiff", overwrite=TRUE)
